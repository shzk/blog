# Ахмад Аваис Мой расширенный рабочий процесс Gulp для WordPress Темы



> Если вы являетесь абсолютным новичком, когда дело доходит до Gulp, вы можете прочитать [«Введение в WPGulp: простой в использовании WordPress Gulp Boilerplate»](https://ahmadawais.com/introducing-wpgulp-an-easy-to-use-wordpress-gulp-boilerplate/) . Более того, этот пост - это просто статья, которая не была обновлена ​​в течение длительного времени. Я поддерживаю этот рабочий процесс в  репозитории [WPGulp](https://github.com/ahmadawais/WPGulp) . Я предлагаю вам всех прочитать это сообщение, чтобы получить представление и использовать WPGulp.


Если вы не используете Gulp или какой-либо бегун для задач, поверьте мне, когда я скажу, что вы упускаете из себя все забавные вещи. Сегодня я намерен поделиться своим расширенным автоматизированным рабочим процессом на основе Gulp для создания тем WordPress с сообществом.

Я помню время, когда мне приходилось минимизировать CSS и JS-файлы, сжимать изображения и суетиться тестирования моих проектов в разных браузерах, не говоря уже о устройствах - ох. Если мое воспоминание об утере не вводит меня в заблуждение, то я тратил на это 30% своих рабочих часов.

К счастью, кто-то написал статью о DRY (Do not Repeat Yourself), и это заставило меня задуматься о недостатках в моем рабочем процессе. Я считаю, что твит из Chris Coyer привел меня к тому, чтобы начать использовать [Grunt](http://gruntjs.com/) в 2012 году или немного позже. Я использовал его уже больше года, а мальчику было весело.

## Почему Gulp?

В то время как Grunt позаботился о оптимизации изображений, сжатии скриптов и компиляции Sass, мне никогда не нравилось писать файлы Grunt. Затем в декабре 2013 года я услышал об этом новом задатчике под названием [Gulp](http://gulpjs.com/) . В воскресенье утром я решил создать фиктивный проект и попробовать Gulp, сказать, что я был подключен, было бы преуменьшением.

### Почему мне нравится глоток?

В то время вряд ли имелась какая-либо документация для использования Gulp с WordPress, но благодаря огромному помогающему сообществу в [Stack Exchange](https://ahmadawais.com/get-free-support-wordpress-questions/) я смог заставить ее работать. Я обнаружил, что Gulp намного лучше, чем Grunt. Вот почему:
* Gulp [легче понять и более эффективно](https://gist.github.com/ahmadawais/260721bbd3e1d5167127)
* Gulp имеет синтаксис JavaScript, в отличие от синтаксиса JSON от Grunt
* Gulp быстрее, чем Grunt (одно время компиляции моей темы длилось от 12 секунд до 300 мс)
* Gulp интуитивно понятен и получает 20K-25k загрузок в день, что равно или отлично, чем загрузка Grunt
* Конфигурация кода Gulp позволяет не только легко писать задачи, но и намного проще читать и поддерживать

Тем не менее, давайте оставим историю на данный момент и посмотрим, каково это - использовать Gulp с WordPress.

### Нужно ли мне использовать глоток?

> Вы веб-разработчик? Вы иногда программируете в HTML / CSS?

- Да!

> Вы когда-нибудь использовали бегуна? Чувствуете, что вы принадлежите каменному веку, а все сумасшедшие дети в городе используют потрясающие передовые рабочие процессы?

- Да! :(.

ОК! давайте начнем тогда.

Поскольку эта статья посвящена расширенному рабочему процессу на основе Gulp, объяснение того, как сделать основной материал, связанный с Gulp, выходит за рамки. Но вместо того, чтобы оставить вас (новичков) в середине нигде, я хотел бы предложить несколько статей, которые помогут вам начать работу.

* Basic: Узнайте, что такое Gulp и как его использовать ([http://ahmda.ws/1EbYodN](http://ahmda.ws/1EbYodN))
* Подробное: Строительство с помощью Gulp ([http://ahmda.ws/1EbYSk4](http://ahmda.ws/1EbYSk4))

Если основной рабочий процесс Gulp не является чем-то новым для вас, то, возможно, вам понравится читать мой расширенный рабочий процесс gulp.

## Продвинутый рабочий процесс WordPress Gulp

При создании премиальных тем для WordPress я получаю много работы, которая включает в себя:

* Минимизация и оптимизация CSS с помощью таблиц стилей и Sass
* Пользовательские скрипты Java и сторонние скрипты через [Bower](http://bower.io/)
* Синхронизация межплатформенного тестирования на разных устройствах
* Туннелирование моей ветви localhost dev на случайный общедоступный URL-адрес для общего доступа
* Построение установочного файла темы zip без каких-либо модулей узлов, файлов кеша или данных DOT-файлов в нем

Давайте рассмотрим, как я получаю все это от Gulp.

Я создал репозиторий Github под названием [Advanced Gulp WordPress](https://github.com/ahmadawais/advanced-gulp-wordpress) . Вы можете проверить структуру файлов внутри, чтобы лучше понять.

`картинка`

## Взгляните на gulpfile.js

Теперь давайте посмотрим на [gulpfile.js](https://github.com/ahmadawais/advanced-gulp-wordpress/blob/master/gulpfile.js), который присутствует в корневой папке нашей темы. Я объясню каждую задачу один за другим, чтобы вам было легче понять. Вы найдете завершенный файл gulpfile.js в конце этого сообщения.

> Поскольку я предполагаю, что вы уже знаете, как работает Gulp, я не буду объяснять, как поместить все плагины / пакеты в файл package.json и другие основные шаги, связанные с настройкой.

### Шаг №1: Настройка переменных

В общем, я собираюсь настроить определенные переменные, чтобы мне не пришлось менять все для каждой другой темы, которую я создаю. Давайте рассмотрим код

`просмотреть исходный файл gulpfile.js, размещенный с ❤помощью GitHub`

Я установил переменные для:
* L # 12 Название проекта
* L # 13 URL проекта на локальном хосте
* L # 14 Путь к папке компонентов Bower
* L # 15 Название папки, которая будет создана для создания установочного zip-файла темы
* L # 16 Переменная `buildInclude` содержит пути к файлам или папкам, которые должны быть включены и исключены при создании чистой темы внутри `buildTheme` папки для создания zip-файла


### Шаг №2: Загрузка плагинов Gulp

Я использую довольно много плагинов gulp, чтобы помочь справиться с тем, что мы обсуждали выше.

`просмотреть исходный файл gulpfile.js, размещенный с ❤помощью GitHub`

Плагины, которые я использую, следующие:
* [Gulp](https://github.com/gulpjs/gulp) - Довольно много самоочевидных
* [BrowserSync](http://www.browsersync.io/)  - Удивительное время, синхронизируемое тестирование браузера
* [AutoPrefixer](https://github.com/sindresorhus/gulp-autoprefixer)  - автоматический префикс CSS для устаревших браузеров
* [UglifyCSS](https://github.com/rezzza/gulp-uglifycss)  - для [оптимизации](https://github.com/rezzza/gulp-uglifycss) CSS
* [Фильтр](https://github.com/sindresorhus/gulp-filter). Позволяет вам работать с подмножеством исходных файлов, фильтруя их с помощью подстановки.
* [UglifyJS](https://github.com/terinjokes/gulp-uglify) - Минимизирует JS-файлы
* [ImageMin](https://github.com/sindresorhus/gulp-imagemin)  - Минимизирует изображения PNG, JPEG, GIF и SVG
* [Newer](https://github.com/tschaub/gulp-newer)  - для передачи только тех исходных файлов, которые являются более новыми, чем соответствующие файлы назначения.
* [Переименовать](https://github.com/hparra/gulp-rename) - легко переименовать файлы
* [Concat](https://github.com/wearefractal/gulp-concat)  - [объединить](https://github.com/wearefractal/gulp-concat) файлы JS
* [Уведомлять](https://github.com/mikaelbr/gulp-notify)  - отправлять уведомления в ОС на основе модуля уведомлений узла
* [Комбинирование запросов к мультимедиа](https://github.com/konitter/gulp-combine-media-queries)  - объединение повторяющихся медиа-запросов после Sass или Less
* [Run Sequence](https://github.com/OverZealous/run-sequence)  - запустить серию зависимых задач gulp в порядке
* [Gulp Sass](https://github.com/dlmanning/gulp-sass)  - плагин Gulp для Sass, основанный на libSass
* [Загрузка плагинов](https://github.com/jackfranklin/gulp-load-plugins)  - автоматическая загрузка плагинов gulp
* [Игнорировать](https://github.com/robrich/gulp-ignore)  - игнорировать файлы в потоке на основе характеристик файла
* [Zip](https://github.com/sindresorhus/gulp-zip)  - для zip или сжатия файлов
* [Plumber](https://github.com/floatdrop/gulp-plumber)  - исправить узловые трубы, не допустить их взлома из-за ошибки
* [Кэш](https://github.com/jgable/gulp-cache)  - задача кэширования прокси для Gulp
* [Source Maps](https://github.com/floridoo/gulp-sourcemaps)  - поддержка исходной карты для частичных файлов CSS

Уф! Это было много. Ну, в конце концов, все это стоит усилий.

### Шаг №3: Задача настройки синхронизации браузера

Давайте немного погрузимся и создадим несколько удивительных задач для автоматизации нашего рабочего процесса. Browsersync - один из моих любимых плагинов.

`просмотреть исходный файл gulpfile.js, размещенный с ❤помощью GitHub`

Раньше у меня был [LiveReload](http://livereload.com/) в моем рабочем процессе , который перезагружал веб-страницу всякий раз, когда файл редактируется и сохраняется. Но когда [Browsersync](http://www.browsersync.io/) был введен, это помогло мне сократить половину из дерьмовых вещей , которые я должен был сделать для того , чтобы автоматизировать синхронизацию между различными браузерами. 

Browsersync помогает мне в следующем:

* Внедрение изменений CSS без перезагрузки любой веб-страницы
* Измените порт и настройте туннель через случайный общедоступный URL-адрес, что означает, что мои товарищи по команде могут получить доступ к ветви dev в моем локальном хосте за считанные минуты
* Синхронизированное тестирование в разных браузерах, где я открываю данный URL на своем рабочем столе, ноутбуке, вкладке и мобильном устройстве, чтобы тестировать одни и те же функции за один раз с синхронизированными прокрутками, кликами, вводами форм и т. Д. Посмотрите видео в  браузере .

### Шаг 4: Задача стиля Gulp

Давайте посмотрим на `styles` задачу, которую я построил. В этой задаче многое происходит. Мы собираем Sass, создавая миниатюрный CSS и оптимизируя медиа-запросы.

`просмотреть исходный файл gulpfile.js, размещенный с ❤помощью GitHub`

Позвольте мне объяснить по очереди, что там происходит:

* L # 1 - L # 8 - я создал `styles` задачу
* L # 9 - Здесь я представил источник файла Sass, который является файлом style.scss, присутствующим в `./assets/css/style.scss`
* L # 10 - Инициированный сантехник, чтобы избежать нарушения труб из-за незначительных ошибок CSS при сохранении файла
* L # 11 - Начаты исходные карты. Исходная карта обеспечивает способ преобразования кода в сжатом файле обратно в исходное положение в исходном файле. Это означает, что - с помощью небольшого программного обеспечения вы можете легко отлаживать свои приложения даже после того, как ваши активы были оптимизированы. Инструменты разработчика Chrome и Firefox поставляются со встроенной поддержкой исходных карт.
* L # 12 - L # 20 - Sass компилируется в компактном формате, вы можете прочитать о форматах Sass [здесь](https://web-design-weekly.com/2014/06/15/different-sass-output-styles/)
* L # 23 - Я префикс CSS с помощью autoprefixer. Устаревшие браузеры, которые должны поддерживаться, упоминаются внутри массива аргументов
* L # 26 - Здесь я сохранил окончательный скомпилированный файл CSS для нашей темы WordPress в корневом каталоге. Поскольку `style.scss` скомпилировался, выход будет style.cssфайлом. Теперь все, что вам нужно сделать, это убедиться, что вы используете «!» В комментариях в верхней части файла style.scss, чтобы, даже когда компиляция / сжатие происходит, комментарий остается: ie `/*! Theme Name: Your Theme etc... */`
* L # 27 - я отфильтровал все .css-файлы в корневом каталоге, который на данный момент является одним `style.css` файлом
* L # 28 - объединить медиа-запросы внутри выбранных файлов
* L # 30 - переименован файл в style.min.css
* L # 31 - L # 33 - Минимизирован файл style.min.css
* L # 34 - Выход был сохранен как файл style.min.css в корневой папке темы WP

### Шаг № 5: Скрининг Минимизация и Конкатенация

Теперь для обработки пользовательских файлов JavaScript и сторонних JS-файлов я создал две задачи, называемые `vendorsJs` и `scriptsJs`. Они оба очень похожи. Давайте рассмотрим код.

`просмотреть исходный файл gulpfile.js, размещенный с ❤помощью GitHub`

Вот что происходит там:

* Я выбрал пути поставщика JS-файлов с помощью пути bower на L # 7 и пути пользовательских JS-файлов в L # 27
* Объединение файлов в два отдельных файла, называемых vendors.js и custom.js
* Сохраненный вывод в `./assets/js/` папке
* Переименовал файлы с помощью .min suffix
* Минимизировать / убрать файлы
* И сохранили еще два файла `vendors.min.js` и `custom.js`

### Шаг №6: Задача оптимизации изображений 

Нет ничего нового в задаче оптимизации изображения. Посмотрите на код ниже.

`просмотреть исходный файл gulpfile.js, размещенный с ❤помощью GitHub`

* Я выбрал `./assets/img/raw/**/*.{png,jpg,gif}` путь как источник
* Оптимизировал изображения и разместил их в `./assets/img/` папке

### Шаг 7: Создание чистого установочного Zip-файла

Это группа задач, которые отвечают за создание чистой копии устанавливаемого zip-файла темы. Кратко посмотрите на код. Нет ничего особенного, это все базовое копирование, вставка и удаление или игнорирование файлов / папок.

`просмотреть исходный файл gulpfile.js, размещенный с ❤помощью GitHub`

Эта задача будет работать только тогда, когда я буду использовать `gulp build` команду. Давайте рассмотрим, что произойдет, когда эта команда запущена:
* **clear**:  Задача по очистке кеш-памяти
* **cleanup**:  Задача удалить sass-cache, bower_components и .DS_Store файлы в потоке. Он также игнорирует папку node_modules
* **cleanupFinal**: другая задача очистки должна запускаться в конце последовательности сборки. Это может иметь или не иметь никакого отличия от `cleanup` задачи
* **buildFiles**:  создать задачу, которая перемещает важные файлы тем в папку buildTheme
* **buildImages**:  Задача по созданию и копированию окончательного набора изображений в папку buildTheme
* **buildZip**:  задача создания установочного Zip-файла папки buildTheme
* **build**:  Основная задача, выполняющая задачу стилей для компиляции CSS, затем очищает все с помощью задачи очистки. После этого он запускает все связанные с сценариями и строит связанные задачи и окончательную задачу очистки в конце, чтобы создать zip-файл темы через папку buildTheme.

### Шаг № 8: Наблюдать за заданием
Наконец, есть задача просмотра, которая помогает автоматически запускать стили, сценарии, изображения и связанные с браузером задачи в случае любых изменений, которые происходят в нижеперечисленной папке.

`просмотреть исходный файл gulpfile.js, размещенный с ❤помощью GitHub`


`просмотреть исходный файл gulpfile.js, размещенный с ❤помощью GitHub`

### Что насчет тебя?

Ну, вот и все. Мне бы хотелось увидеть, как вы, люди, используете Gulp для автоматизации работы, связанной с фронтоном. Если у вас есть какие-либо вопросы или предложения, сообщите мне в разделе комментариев ниже.

Я также хотел бы упомянуть и поблагодарить [Криса Койера](https://twitter.com/chriscoyier), [Алекса Васкеса](https://twitter.com/alexjvasquez), [Мэтта Бэнкса](https://twitter.com/mattbanks) и всех [вкладчиков Gulp](https://github.com/gulpjs/gulp/graphs/contributors) , которые помогли мне на этом пути с их кодом и вкладами в GPL / MIT. Запросы на получение приветствуются.

Вам понравилось то, что вы читали? 